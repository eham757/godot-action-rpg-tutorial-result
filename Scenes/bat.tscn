[gd_scene load_steps=24 format=3 uid="uid://cfdkfmy1gitks"]

[ext_resource type="Texture2D" uid="uid://b0j3rr585r2sl" path="res://Assets/enemies/bat.png" id="1_j7be8"]
[ext_resource type="Script" uid="uid://bonrnqymy3ph1" path="res://Scripts/bat_enemy.gd" id="1_wt6c1"]
[ext_resource type="Texture2D" uid="uid://cj13d1oee0kyj" path="res://Assets/shadows/small_shadow.png" id="2_jckqh"]
[ext_resource type="Script" uid="uid://cl7cqm52ekx5p" path="res://stats.gd" id="2_mqh3e"]
[ext_resource type="Script" uid="uid://cmebxjx8s4v2l" path="res://Scripts/hurtbox.gd" id="4_50dnf"]
[ext_resource type="Script" uid="uid://dnp4g5w4trr8b" path="res://Scripts/hitbox.gd" id="6_y36tb"]

[sub_resource type="Resource" id="Resource_y36tb"]
script = ExtResource("2_mqh3e")
health = 3
max_health = 3
metadata/_custom_type_script = "uid://cl7cqm52ekx5p"

[sub_resource type="Animation" id="Animation_wt6c1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:collision_layer")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [4]
}

[sub_resource type="Animation" id="Animation_jckqh"]
resource_name = "fly"
length = 0.5
loop_mode = 1
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4]
}

[sub_resource type="Animation" id="Animation_50dnf"]
resource_name = "hit"
length = 0.2
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:collision_layer")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [0, 4]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_50dnf"]
_data = {
&"RESET": SubResource("Animation_wt6c1"),
&"fly": SubResource("Animation_jckqh"),
&"hit": SubResource("Animation_50dnf")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_50dnf"]
animation = &"fly"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_y36tb"]
animation = &"hit"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_mqh3e"]
animation = &"fly"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_y36tb"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_cawgt"]
advance_mode = 2
advance_expression = "can_see_player()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_fk7gk"]
advance_mode = 2
advance_expression = "not can_see_player()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_50dnf"]
advance_mode = 2
advance_expression = "velocity == Vector2(0,0)"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_mqh3e"]
states/ChaseState/node = SubResource("AnimationNodeAnimation_50dnf")
states/ChaseState/position = Vector2(496, 173)
states/HitState/node = SubResource("AnimationNodeAnimation_y36tb")
states/HitState/position = Vector2(680, 54)
states/IdleState/node = SubResource("AnimationNodeAnimation_mqh3e")
states/IdleState/position = Vector2(496, 54)
transitions = ["Start", "IdleState", SubResource("AnimationNodeStateMachineTransition_y36tb"), "IdleState", "ChaseState", SubResource("AnimationNodeStateMachineTransition_cawgt"), "ChaseState", "IdleState", SubResource("AnimationNodeStateMachineTransition_fk7gk"), "HitState", "IdleState", SubResource("AnimationNodeStateMachineTransition_50dnf")]
graph_offset = Vector2(-257, -22)

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_y36tb"]
graph_offset = Vector2(-351, 29)
nodes/StateMachine/node = SubResource("AnimationNodeStateMachine_mqh3e")
nodes/StateMachine/position = Vector2(40, 140)
node_connections = [&"output", 0, &"StateMachine"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_fk7gk"]
radius = 5.0
height = 22.0

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_y36tb"]
radius = 5.0
height = 22.0

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_cawgt"]
radius = 5.0
height = 22.0

[node name="BatEnemy" type="CharacterBody2D"]
collision_layer = 4
collision_mask = 5
motion_mode = 1
script = ExtResource("1_wt6c1")
stats = SubResource("Resource_y36tb")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_j7be8")
offset = Vector2(0, -6)
hframes = 5

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_50dnf")
}
autoplay = "fly"

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeBlendTree_y36tb")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../AnimationPlayer")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -4)
shape = SubResource("CapsuleShape2D_fk7gk")

[node name="ShadowSprite" type="Sprite2D" parent="."]
show_behind_parent = true
position = Vector2(0, 6)
texture = ExtResource("2_jckqh")

[node name="RayCast2D" type="RayCast2D" parent="."]
target_position = Vector2(8, 0)

[node name="HurtBoxArea" type="Area2D" parent="."]
collision_layer = 16
collision_mask = 16
script = ExtResource("4_50dnf")
metadata/_custom_type_script = "uid://cmebxjx8s4v2l"

[node name="CollisionShape2D" type="CollisionShape2D" parent="HurtBoxArea"]
position = Vector2(0, -4)
shape = SubResource("CapsuleShape2D_y36tb")

[node name="Hitbox" type="Area2D" parent="."]
collision_layer = 8
collision_mask = 8
script = ExtResource("6_y36tb")
metadata/_custom_type_script = "uid://dnp4g5w4trr8b"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hitbox"]
position = Vector2(0, -4)
shape = SubResource("CapsuleShape2D_cawgt")
debug_color = Color(0.94711775, 0.21030328, 0.25676292, 0.41960785)

[node name="Center" type="Marker2D" parent="."]
position = Vector2(0, -10)
